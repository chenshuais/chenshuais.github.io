<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="//cdn.staticfile.net/Primer/21.0.7/primer.css" rel="stylesheet" />
    <link rel="icon" href="https://ian2018.cn/favicon.png"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="`Gmeek-html<img src='https://blog-image.ian2018.cn/images/2bba4a3bdad5d534b40c4ffa5281b2761d91b28a.png'>`

Android æœ€è¿‘æ¨è¡Œçš„ Compose ï¼Œæœ‰ç€ Kotlin çš„åŠ æŒï¼Œä½¿å†™ UI æ›´åŠ æ–¹ä¾¿å¿«é€Ÿï¼Œä¸ç”¨æ‹…å¿ƒå¸ƒå±€åµŒå¥—ï¼Œè¿˜æ˜¯å£°æ˜å¼ UIï¼Œé‚£ä¹ˆ Compose æœ‰è¿™ä¹ˆå¤šå¥½å¤„ï¼ŒåŸç”Ÿå†™æ³•è¿˜æœ‰ â€œå‡ºè·¯â€ å—ï¼Ÿ

ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ç§éä¼ ç»Ÿçš„è‡ªå®šä¹‰ ViewGroup å†™æ³•ï¼Œè®©ä½ å¯¹è‡ªå®šä¹‰ ViewGroup ä¸å† â€œææƒ§â€ï¼Œå†å€ŸåŠ© Kotlin ï¼Œæˆ‘ä»¬ç”¨åŸç”Ÿå†™æ³•ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿå†™å‡ºæ— åµŒå¥—çš„å¸ƒå±€ã€‚">
<meta property="og:title" content="Kotlin å†™è‡ªå®šä¹‰ ViewGroup">
<meta property="og:description" content="`Gmeek-html<img src='https://blog-image.ian2018.cn/images/2bba4a3bdad5d534b40c4ffa5281b2761d91b28a.png'>`

Android æœ€è¿‘æ¨è¡Œçš„ Compose ï¼Œæœ‰ç€ Kotlin çš„åŠ æŒï¼Œä½¿å†™ UI æ›´åŠ æ–¹ä¾¿å¿«é€Ÿï¼Œä¸ç”¨æ‹…å¿ƒå¸ƒå±€åµŒå¥—ï¼Œè¿˜æ˜¯å£°æ˜å¼ UIï¼Œé‚£ä¹ˆ Compose æœ‰è¿™ä¹ˆå¤šå¥½å¤„ï¼ŒåŸç”Ÿå†™æ³•è¿˜æœ‰ â€œå‡ºè·¯â€ å—ï¼Ÿ

ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ç§éä¼ ç»Ÿçš„è‡ªå®šä¹‰ ViewGroup å†™æ³•ï¼Œè®©ä½ å¯¹è‡ªå®šä¹‰ ViewGroup ä¸å† â€œææƒ§â€ï¼Œå†å€ŸåŠ© Kotlin ï¼Œæˆ‘ä»¬ç”¨åŸç”Ÿå†™æ³•ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿå†™å‡ºæ— åµŒå¥—çš„å¸ƒå±€ã€‚">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.ian2018.club/post/Kotlin%20-xie-zi-ding-yi-%20ViewGroup.html">
<meta property="og:image" content="https://blog-image.ian2018.cn/avatar.webp">
<title>Kotlin å†™è‡ªå®šä¹‰ ViewGroup</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />

</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
</style>
<style>#user-content-page_pv{color:red}#user-content-page_uv{color:red}</style>



<body>
    <div id="header">
<h1 class="postTitle">Kotlin å†™è‡ªå®šä¹‰ ViewGroup</h1>
<div class="title-right">
    <a href="https://blog.ian2018.club" id="buttonHome" class="btn btn-invisible circle" title="é¦–é¡µ">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="åˆ‡æ¢ä¸»é¢˜">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><p><img src="https://blog-image.ian2018.cn/images/2bba4a3bdad5d534b40c4ffa5281b2761d91b28a.png"></p>
<p>Android æœ€è¿‘æ¨è¡Œçš„ Compose ï¼Œæœ‰ç€ Kotlin çš„åŠ æŒï¼Œä½¿å†™ UI æ›´åŠ æ–¹ä¾¿å¿«é€Ÿï¼Œä¸ç”¨æ‹…å¿ƒå¸ƒå±€åµŒå¥—ï¼Œè¿˜æ˜¯å£°æ˜å¼ UIï¼Œé‚£ä¹ˆ Compose æœ‰è¿™ä¹ˆå¤šå¥½å¤„ï¼ŒåŸç”Ÿå†™æ³•è¿˜æœ‰ â€œå‡ºè·¯â€ å—ï¼Ÿ</p>
<p>ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ç§éä¼ ç»Ÿçš„è‡ªå®šä¹‰ ViewGroup å†™æ³•ï¼Œè®©ä½ å¯¹è‡ªå®šä¹‰ ViewGroup ä¸å† â€œææƒ§â€ï¼Œå†å€ŸåŠ© Kotlin ï¼Œæˆ‘ä»¬ç”¨åŸç”Ÿå†™æ³•ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿå†™å‡ºæ— åµŒå¥—çš„å¸ƒå±€ã€‚</p>
<h2>ä¸ºä»€ä¹ˆè¦ç”¨è‡ªå®šä¹‰ ViewGroup</h2>
<p>å¹³æ—¶å¤§å®¶å†™ UIï¼Œéƒ½ç›´æ¥ç”¨ xml å»å†™å¸ƒå±€ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ä¼šæ³¨æ„å»é¿å…å¸ƒå±€åµŒå¥—ï¼Œè‡ªä»æœ‰äº† ConstraintLayoutï¼ŒåµŒå¥—çš„æƒ…å†µå°±å‡å°‘äº†è®¸å¤šï¼Œä½†ç”¨ ConstraintLayout å°±èƒ½è¾¾åˆ°æè‡´æ€§èƒ½å—ï¼Ÿæ•´ä½“ä¸Šç›¸è¾ƒäºå…¶ä»– Layout ï¼Œæ€§èƒ½ç¡®å®<a href="https://cloud.tencent.com/developer/article/1365408" rel="nofollow">æœ‰æ‰€æå‡</a>ã€‚ä½†å¯¹äºäº§å“ä¸­å…·ä½“çš„é¡µé¢ï¼Œå¯èƒ½å°±ä¸ä¼šè¾¾åˆ°æè‡´æ€§èƒ½ï¼Œå› ä¸º ConstraintLayout è¦è€ƒè™‘çš„åœºæ™¯å¤ªå¤šäº†ï¼Œå¯¼è‡´å…¶é€»è¾‘å¾ˆå¤æ‚ï¼Œå¯¹äºç¡®å®šçš„é¡µé¢æ¥è¯´ï¼Œä¸€ä¸ªæœ‰ â€œé’ˆå¯¹æ€§â€ çš„è‡ªå®šä¹‰ ViewGroup ï¼Œæ˜¯èƒ½å¤Ÿè¶…è¶Š ConstraintLayout çš„ï¼Œå› ä¸ºä½ åªéœ€è¦å¯¹ä¸€ä¸ªé¡µé¢è´Ÿè´£å³å¯ï¼Œä¸ç”¨è€ƒè™‘é‚£ä¹ˆå…¨ã€‚</p>
<p>è¿™é‡Œæˆ‘æ‰€è¯´çš„è‡ªå®šä¹‰ ViewGroup å°±æ˜¯ç”¨ä»£ç å»å†™å¸ƒå±€ï¼Œä¸æ˜¯å†™ä¸€ä¸ªå…¬å…±çš„æ§ä»¶è®©åˆ«äººå»ä½¿çš„é‚£ç§ã€‚<a href="https://github.com/DrKLO/Telegram/">Telegram</a> çš„å¸ƒå±€å°±å…¨éƒ¨ç”¨ä»£ç å»å†™çš„ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¹³æ—¶ä¸ºä»€ä¹ˆä¸å»ç”¨ä»£ç å†™å¸ƒå±€å‘¢ï¼Ÿ</p>
<ul>
<li>è‡ªå®šä¹‰ ViewGroup å¤ªå¤æ‚äº†ï¼Œä»€ä¹ˆ MeasureSpec æƒ…å†µæœ‰ä¸€å †ã€‚</li>
<li>æ¯æ¬¡å†™éƒ½å¿˜ï¼Œè¿˜å¾—å»æŸ¥ï¼Œå­¦äº†å°±å¿˜</li>
<li>æ•ˆç‡å¤ªä½ï¼Œæˆ‘ä¸ºäº†é‚£ç‚¹æ€§èƒ½æå‡ï¼Œæ²¡å¿…è¦</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯å› ä¸ºè‡ªå®šä¹‰ ViewGroup æ¯”è¾ƒéš¾ï¼Œè¿˜è´¹äº‹ã€‚ä»¥å‰ç”¨ Java å†™ä»£ç ç¡®å®ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œä½†ç°åœ¨æœ‰äº† Kotlinï¼Œä¹Ÿå¯ä»¥å¾ˆä¼˜é›…çš„å»ç”¨ä»£ç å†™å¸ƒå±€äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å¸¦å¤§å®¶æ¥æ‹ä¸€ä¸‹è‡ªå®šä¹‰ ViewGroup çš„æµç¨‹ï¼Œç„¶åç”¨ Kotlin å»å®ç°ã€‚</p>
<h2>è‡ªå®šä¹‰ ViewGroup è¦åšä»€ä¹ˆ</h2>
<p>ä¸€ä¸ª ViewGroup æœ‰å“ªå‡ æ­¥ï¼Œæˆ‘æƒ³å¤§å®¶éƒ½çŸ¥é“ï¼Œæ— éå°±æ˜¯æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ï¼Œå°±è¿™ä¸‰æ­¥ï¼Œæµ‹é‡å°±æ˜¯æŠŠå­ View çš„å¤§å°æµ‹é‡ä¸€ä¸‹ï¼Œå†ç®—ä¸€ä¸‹è‡ªå·±çš„å¤§å°ï¼›å¸ƒå±€å°±æ˜¯è®¾ç½®ä¸€ä¸‹å­ View çš„ä½ç½®ï¼›ç»˜åˆ¶å¯¹äº ViewGroup æ¥è¯´ä¸€èˆ¬ä¸éœ€è¦ï¼Œæ— éå°±æ˜¯åœ¨è‡ªå·±è¿™ç”»ç‚¹ä»€ä¹ˆä¸œè¥¿ã€‚è¿™ä¹ˆçœ‹ä¹Ÿä¸æ˜¯å¾ˆéš¾å˜›ï¼Œé‚£ä¹ˆéš¾çš„æ˜¯å“ªé‡Œå‘¢ï¼Ÿæˆ‘æƒ³å°±æ˜¯å› ä¸ºä¸‹é¢è¿™å¼ è¡¨ï¼š</p>
<p><img src="https://blog-image.ian2018.cn/images/d6cfd28d1c2d38c89b5e4eb097ac3f6215240320.png"></p>
<p>å°±æ˜¯æµ‹é‡çš„æ—¶å€™çš„å„ç§æ¨¡å¼ï¼Œå¾ˆå¤šä¹¦ä¸Šè®²è‡ªå®šä¹‰ View çš„æ—¶å€™éƒ½ä¼šç»™å‡ºè¿™å¼ è¡¨ï¼Œå…¶å®è¿™æ˜¯ä½œè€…è‡ªå·±æ€»ç»“å‡ºæ¥çš„ï¼ŒAndroid å®˜ç½‘ä¸Šæ˜¯æ²¡æœ‰è¿™äº›ä¸œè¥¿çš„ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬å¿˜è®°ä¸Šé¢è¿™å¼ è¡¨ï¼Œå°±åªçœ‹ä¸€ä¸‹æœ‰å‡ ç§æµ‹é‡æ¨¡å¼ï¼šEXACTLYã€AT_MOSTã€UNSPECIFIEDï¼Œè¿™ä¸‰ä¸ªè‹±æ–‡æ„æ€å·²ç»å¾ˆæ˜ç¡®äº†ã€‚</p>
<ul>
<li>EXACTLY å°±æ˜¯ç²¾ç¡®çš„ï¼Œå°±æ˜¯ä½ è®¾ç½®å¤šå°‘å°±æ˜¯å¤šå°‘</li>
<li>AT_MOST å°±æ˜¯æœ€å¤šèƒ½ç”¨å¤šå°‘ï¼Œå°±æ˜¯å°½å¯èƒ½æ»¡è¶³å­ View</li>
<li>UNSPECIFIED å°±æ˜¯ä¸ç¡®å®šçš„ï¼Œè¿™ç§ä¸€èˆ¬éƒ½æ˜¯éœ€è¦å†æ¬¡æµ‹é‡çš„ï¼Œå°±æ¯”å¦‚ LinearLayout ä½¿ç”¨ weight</li>
</ul>
<p>å…¶ä¸­ UNSPECIFIED å¯¹äºæˆ‘ä»¬ç”¨ä»£ç å†™å¸ƒå±€è¿™ç§æƒ…å†µï¼Œå‡ ä¹å°±ä¸ä¼šç”¨åˆ°ï¼Œè¿™ç§å°±å¯ä»¥ä¸ç”¨è€ƒè™‘ï¼Œé‚£ä¹ˆå°±åªå‰©ä¸‹ä¸¤ç§æ¨¡å¼äº†ï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯ â€œView å®é™…å¤šå°‘å°±æ˜¯å¤šå°‘â€ å’Œ "View æœ€å¤šèƒ½ç”¨å¤šå°‘"ï¼Œè¿™ä¹ˆä¸€æƒ³ï¼Œæ˜¯ä¸æ˜¯å°±æ²¡é‚£ä¹ˆå¤æ‚äº†ã€‚å…‰è¯´å¤§å®¶ä¼°è®¡ä¹Ÿæ²¡æœ‰å…·ä½“çš„æ¦‚å¿µï¼Œæ¥ä¸‹æ¥ä¸Šä»£ç ã€‚</p>
<h2>å¦‚ä½•å€ŸåŠ© Kotlin æå‡å†™ ViewGroup æ•ˆç‡</h2>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç”¨ Kotlin çš„æ‰©å±•æ–¹æ³•ï¼Œæ¥ä¸€æ­¥ä¸€æ­¥å»å®Œæˆè‡ªå®šä¹‰ ViewGroup éœ€è¦çš„ä¸œè¥¿ã€‚</p>
<p>æµ‹é‡çš„æ—¶å€™è¦ä¼ ä¸€ä¸ª MeasureSpec å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹æ®å®½é«˜ Int å€¼å’Œæµ‹é‡æ¨¡å¼ç¡®å®šçš„ï¼Œæœ‰äº† Kotlin ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥ç»™ Int å®šä¹‰ä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œæ¥è·å–è¿™ä¸ª Int å€¼çš„ MeasureSpec ä¸å°±è¡Œäº†ï¼Œæ¥ï¼Œçœ‹ä»£ç ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"><span class="pl-c"><span class="pl-c">//</span> EXACTLY çš„æµ‹é‡æ¨¡å¼</span>
<span class="pl-k">fun</span> Int.<span class="pl-en">toExactlyMeasureSpec</span>() <span class="pl-k">=</span> <span class="pl-en">MeasureSpec</span>.makeMeasureSpec(<span class="pl-c1">this</span>, <span class="pl-en">MeasureSpec</span>.<span class="pl-en">EXACTLY</span>)
<span class="pl-c"><span class="pl-c">//</span> AT_MOST çš„æµ‹é‡æ¨¡å¼</span>
<span class="pl-k">fun</span> Int.<span class="pl-en">toAtMostMeasureSpec</span>() <span class="pl-k">=</span> <span class="pl-en">MeasureSpec</span>.makeMeasureSpec(<span class="pl-c1">this</span>, <span class="pl-en">MeasureSpec</span>.<span class="pl-en">AT_MOST</span>)</pre></div>
<p>æˆ‘ä»¬ç»™ä¸€ä¸ªæ§ä»¶è®¾ç½®å®½é«˜ï¼Œä¸€èˆ¬éƒ½æ˜¯ç»™ä¸ªå…·ä½“çš„å€¼ï¼Œè¦ä¹ˆå°±æ˜¯ MATCH_PARENT æˆ–è€… WRAP_CONTENTï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¹Ÿè¿™ç§å¸¸è§çš„æƒ…å†µæŠ½æˆä¸€ä¸ªæ–¹æ³•å‘¢ï¼Ÿæœ‰äº† Kotlin æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ª View ä¸Šå¼„ä¸ªæ‰©å±•æ–¹æ³•ï¼Œæ¥è·å–å®ƒçš„é»˜è®¤å®½é«˜ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"><span class="pl-c"><span class="pl-c">//</span> è·å– View å®½åº¦çš„é»˜è®¤æµ‹é‡å€¼</span>
<span class="pl-k">fun</span> View.<span class="pl-en">defaultWidthMeasureSpec</span>(<span class="pl-smi">parent</span><span class="pl-k">:</span> <span class="pl-en">ViewGroup</span>): <span class="pl-c1">Int</span> {
    <span class="pl-k">return</span> <span class="pl-k">when</span> (layoutParams.width) {
        <span class="pl-c"><span class="pl-c">//</span> å¦‚æœæ˜¯ MATCH_PARENTï¼Œå°±è¯´æ˜å®ƒè¦å¡«æ»¡çˆ¶å¸ƒå±€ï¼Œé‚£å°±ç»™å®ƒä¸€ä¸ªçˆ¶å¸ƒå±€å®½åº¦çš„ç²¾ç¡®å€¼å‘—</span>
        <span class="pl-en">MATCH_PARENT</span> <span class="pl-k">-&gt;</span> parent.measuredWidth.toExactlyMeasureSpec()
        <span class="pl-c"><span class="pl-c">//</span> å¦‚æœæ˜¯ WRAP_CONTENTï¼Œå°±è¯´æ˜å®ƒæ»¡è¶³è‡ªå·±çš„å¤§å°å°±è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½æä¾›å‰©ä½™å¯ç”¨ç©ºé—´</span>
        <span class="pl-en">WRAP_CONTENT</span> <span class="pl-k">-&gt;</span> <span class="pl-en">WRAP_CONTENT</span>.toAtMostMeasureSpec()
        <span class="pl-c"><span class="pl-c">//</span> 0 å°±æ˜¯ä¸ç¡®å®šçš„ï¼Œè¿™é‡Œæˆ‘ä»¬æœ‰ UI ç¨¿ï¼Œå°±æ²¡æœ‰ä¸ç¡®å®šçš„æƒ…å†µäº†ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸ç”¨è€ƒè™‘äº†</span>
        <span class="pl-c1">0</span> <span class="pl-k">-&gt;</span> <span class="pl-k">throw</span> <span class="pl-en">IllegalAccessException</span>(<span class="pl-s"><span class="pl-pds">"</span>æˆ‘ä¸è€ƒè™‘è¿™ç§æƒ…å†µ <span class="pl-e">$this</span><span class="pl-pds">"</span></span>)
        <span class="pl-c"><span class="pl-c">//</span> æœ€åå°±æ˜¯å…·ä½“çš„å€¼äº†ï¼Œé‚£å°±ç»™ä½ å…·ä½“çš„å‘—</span>
        <span class="pl-k">else</span> <span class="pl-k">-&gt;</span> layoutParams.width.toExactlyMeasureSpec()
    }
}
<span class="pl-c"><span class="pl-c">//</span> è·å– View é«˜åº¦çš„é»˜è®¤æµ‹é‡å€¼ï¼Œå’Œä¸Šé¢è·å–å®½åº¦çš„åŸç†ä¸€æ ·</span>
<span class="pl-k">fun</span> View.<span class="pl-en">defaultHeightMeasureSpec</span>(<span class="pl-smi">parent</span><span class="pl-k">:</span> <span class="pl-en">ViewGroup</span>): <span class="pl-c1">Int</span> {
    <span class="pl-k">return</span> <span class="pl-k">when</span> (layoutParams.height) {
        <span class="pl-en">MATCH_PARENT</span> <span class="pl-k">-&gt;</span> parent.measuredHeight.toExactlyMeasureSpec()
        <span class="pl-en">WRAP_CONTENT</span> <span class="pl-k">-&gt;</span> <span class="pl-en">WRAP_CONTENT</span>.toAtMostMeasureSpec()
        <span class="pl-c1">0</span> <span class="pl-k">-&gt;</span> <span class="pl-k">throw</span> <span class="pl-en">IllegalAccessException</span>(<span class="pl-s"><span class="pl-pds">"</span>æˆ‘ä¸è€ƒè™‘è¿™ç§æƒ…å†µ <span class="pl-e">$this</span><span class="pl-pds">"</span></span>)
        <span class="pl-k">else</span> <span class="pl-k">-&gt;</span> layoutParams.height.toExactlyMeasureSpec()
    }
}</pre></div>
<p>å¥½äº†ï¼Œæœ‰äº†è¿™äº›ï¼Œæˆ‘ä»¬å†å†™è‡ªå®šä¹‰ ViewGroup æ˜¯ä¸æ˜¯å°±ç®€å•å¤šäº†ï¼Œæˆ‘ä»¬æµ‹é‡ä¸€ä¸ªæ§ä»¶ï¼Œç›´æ¥è¿™äº›å†™å°±å¯ä»¥äº†ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate">textView.measure(textView.defaultWidthMeasureSpec(<span class="pl-c1">this</span>), textView.defaultHeightMeasureSpec(<span class="pl-c1">this</span>))</pre></div>
<p>ç­‰ç­‰ï¼Œè¿™æ ·å†™è¿˜æ˜¯æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸å¹²è„†å†å®šä¹‰ä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œè®© View ç›´æ¥æŒ‰é»˜è®¤çš„æµ‹é‡å¥½äº†ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"><span class="pl-k">fun</span> View.<span class="pl-en">autoMeasure</span>(<span class="pl-smi">parent</span><span class="pl-k">:</span> <span class="pl-en">ViewGroup</span>) {
    measure(
        <span class="pl-c1">this</span>.defaultWidthMeasureSpec(parent),
        <span class="pl-c1">this</span>.defaultHeightMeasureSpec(parent)
    )
}</pre></div>
<p>è¿™æ ·ä¸‹æ¬¡ä½¿ç”¨å°±å¯ä»¥è¿™æ ·å†™äº†ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate">textView.autoMeasure(<span class="pl-c1">this</span>)</pre></div>
<p>æ˜¯ä¸æ˜¯æ›´ç®€å•äº†ï¼Œåˆ°è¿™ï¼Œæµ‹é‡çš„åŸºæœ¬ä»£ç å·®ä¸å¤šå°±å†™å®Œäº†ï¼Œé¡ºä¾¿æŠŠå¸ƒå±€çš„åŸºç¡€æ–¹æ³•ä¹Ÿå†™ä¸€ä¸‹å§ï¼Œå¸ƒå±€å°±æ¯”è¾ƒç®€å•äº†ï¼Œå°±æ˜¯å‘Šè¯‰å­ View çš„ä½ç½®å°±å¥½äº†ã€‚</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"><span class="pl-c"><span class="pl-c">//</span> è®¾ç½® view çš„ä½ç½®</span>
<span class="pl-k">fun</span> View.<span class="pl-en">autoLayout</span>(<span class="pl-smi">parent</span><span class="pl-k">:</span> <span class="pl-en">ViewGroup</span>, <span class="pl-smi">x</span><span class="pl-k">:</span> <span class="pl-c1">Int</span> = 0, <span class="pl-smi">y</span><span class="pl-k">:</span> <span class="pl-c1">Int</span> = 0, <span class="pl-smi">fromRight</span><span class="pl-k">:</span> <span class="pl-c1">Boolean</span> = false) {
    <span class="pl-c"><span class="pl-c">//</span> åˆ¤æ–­å¸ƒå±€æ˜¯ä¸æ˜¯ä»å³è¾¹å¼€å§‹</span>
    <span class="pl-k">if</span> (<span class="pl-k">!</span>fromRight) {
        <span class="pl-c"><span class="pl-c">//</span> æ³¨æ„è¿™é‡Œä¸ºä»€ä¹ˆç”¨ measuredWidth è€Œä¸æ˜¯ç”¨ width</span>
        <span class="pl-c"><span class="pl-c">//</span> å› ä¸º width æ˜¯é€šè¿‡ mRight - mLeft è®¡ç®—çš„ï¼Œè€Œè¿™æ—¶å®ƒä¿©éƒ½æ²¡æœ‰è¢«èµ‹å€¼ï¼Œæ‰€ä»¥éƒ½æ˜¯ 0</span>
        layout(x, y, x <span class="pl-k">+</span> measuredWidth, y <span class="pl-k">+</span> measuredHeight)
    } <span class="pl-k">else</span> {
        autoLayout(parent.measuredWidth <span class="pl-k">-</span> x <span class="pl-k">-</span> measuredWidth, y)
    }
}</pre></div>
<p>æˆ‘ä»¬å…¶å®å¯ä»¥æŠŠè¿™äº›æ–¹æ³•éƒ½å†™åˆ°ä¸€ä¸ªç±»ï¼Œä»¥åå†™è‡ªå®šä¹‰ ViewGroupï¼Œç›´æ¥ç»§æ‰¿å®ƒå°±å¯ä»¥äº†ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"> <span class="pl-c"><span class="pl-c">//</span> ä¸ºäº†æ–¹ä¾¿è®¾ç½® dp spï¼Œç›´æ¥åœ¨è¿™é‡Œå£°æ˜äº†æ‰©å±•å±æ€§</span>
<span class="pl-k">val</span> <span class="pl-c1">Int</span>.dp
    get() <span class="pl-k">=</span> <span class="pl-en">TypedValue</span>.applyDimension(
        <span class="pl-en">TypedValue</span>.<span class="pl-en">COMPLEX_UNIT_DIP</span>, <span class="pl-c1">this</span>.toFloat(), 
        <span class="pl-en">Resources</span>.getSystem().displayMetrics
    ).toInt()
<span class="pl-k">val</span> <span class="pl-c1">Float</span>.sp
    get() <span class="pl-k">=</span> <span class="pl-en">TypedValue</span>.applyDimension(
        <span class="pl-en">TypedValue</span>.<span class="pl-en">COMPLEX_UNIT_SP</span>, <span class="pl-c1">this</span>,
        <span class="pl-en">Resources</span>.getSystem().displayMetrics
    )

<span class="pl-k">abstract</span> <span class="pl-k">class</span> <span class="pl-en">CustomViewGroup</span>(<span class="pl-smi">context</span><span class="pl-k">:</span> <span class="pl-en">Context</span>) : ViewGroup(context) {

    <span class="pl-c"><span class="pl-c">//</span> æ–¹ä¾¿è·å–å¸¦ Margin çš„å®½é«˜</span>
    <span class="pl-k">protected</span> <span class="pl-k">val</span> <span class="pl-en">View</span>.measuredWidthWithMargins get() <span class="pl-k">=</span> measuredWidth <span class="pl-k">+</span> marginStart <span class="pl-k">+</span> marginEnd
    <span class="pl-k">protected</span> <span class="pl-k">val</span> <span class="pl-en">View</span>.measuredHeightWithMargins get() <span class="pl-k">=</span> measuredHeight <span class="pl-k">+</span> marginTop <span class="pl-k">+</span> marginBottom

    <span class="pl-k">protected</span> <span class="pl-k">fun</span> Int.<span class="pl-en">toExactlyMeasureSpec</span>() <span class="pl-k">=</span> <span class="pl-en">MeasureSpec</span>.makeMeasureSpec(<span class="pl-c1">this</span>, <span class="pl-en">MeasureSpec</span>.<span class="pl-en">EXACTLY</span>)
  
    <span class="pl-k">protected</span> <span class="pl-k">fun</span> Int.<span class="pl-en">toAtMostMeasureSpec</span>() <span class="pl-k">=</span> <span class="pl-en">MeasureSpec</span>.makeMeasureSpec(<span class="pl-c1">this</span>, <span class="pl-en">MeasureSpec</span>.<span class="pl-en">AT_MOST</span>)

    <span class="pl-k">protected</span> <span class="pl-k">fun</span> View.<span class="pl-en">defaultWidthMeasureSpec</span>(<span class="pl-smi">parent</span><span class="pl-k">:</span> <span class="pl-en">ViewGroup</span>): <span class="pl-c1">Int</span> {
        <span class="pl-k">return</span> <span class="pl-k">when</span> (layoutParams.width) {
            <span class="pl-en">MATCH_PARENT</span> <span class="pl-k">-&gt;</span> parent.measuredWidth.toExactlyMeasureSpec()
            <span class="pl-en">WRAP_CONTENT</span> <span class="pl-k">-&gt;</span> <span class="pl-en">WRAP_CONTENT</span>.toAtMostMeasureSpec()
            <span class="pl-c1">0</span> <span class="pl-k">-&gt;</span> <span class="pl-k">throw</span> <span class="pl-en">IllegalAccessException</span>(<span class="pl-s"><span class="pl-pds">"</span>æˆ‘ä¸è€ƒè™‘è¿™ç§æƒ…å†µ <span class="pl-e">$this</span><span class="pl-pds">"</span></span>)
            <span class="pl-k">else</span> <span class="pl-k">-&gt;</span> layoutParams.width.toExactlyMeasureSpec()
        }
    }

    <span class="pl-k">protected</span> <span class="pl-k">fun</span> View.<span class="pl-en">defaultHeightMeasureSpec</span>(<span class="pl-smi">parent</span><span class="pl-k">:</span> <span class="pl-en">ViewGroup</span>): <span class="pl-c1">Int</span> {
        <span class="pl-k">return</span> <span class="pl-k">when</span> (layoutParams.height) {
            <span class="pl-en">MATCH_PARENT</span> <span class="pl-k">-&gt;</span> parent.measuredHeight.toExactlyMeasureSpec()
            <span class="pl-en">WRAP_CONTENT</span> <span class="pl-k">-&gt;</span> <span class="pl-en">WRAP_CONTENT</span>.toAtMostMeasureSpec()
            <span class="pl-c1">0</span> <span class="pl-k">-&gt;</span> <span class="pl-k">throw</span> <span class="pl-en">IllegalAccessException</span>(<span class="pl-s"><span class="pl-pds">"</span>æˆ‘ä¸è€ƒè™‘è¿™ç§æƒ…å†µ <span class="pl-e">$this</span><span class="pl-pds">"</span></span>)
            <span class="pl-k">else</span> <span class="pl-k">-&gt;</span> layoutParams.height.toExactlyMeasureSpec()
        }
    }

    <span class="pl-k">protected</span> <span class="pl-k">fun</span> View.<span class="pl-en">autoMeasure</span>() {
        measure(
            <span class="pl-c1">this</span>.defaultWidthMeasureSpec(<span class="pl-c1">this</span>@CustomViewGroup),
            <span class="pl-c1">this</span>.defaultHeightMeasureSpec(<span class="pl-c1">this</span>@CustomViewGroup)
        )
    }

    <span class="pl-k">protected</span> <span class="pl-k">fun</span> View.<span class="pl-en">autoLayout</span>(<span class="pl-smi">x</span><span class="pl-k">:</span> <span class="pl-c1">Int</span> = 0, <span class="pl-smi">y</span><span class="pl-k">:</span> <span class="pl-c1">Int</span> = 0, <span class="pl-smi">fromRight</span><span class="pl-k">:</span> <span class="pl-c1">Boolean</span> = false) {
        <span class="pl-k">if</span> (<span class="pl-k">!</span>fromRight) {
            layout(x, y, x <span class="pl-k">+</span> measuredWidth, y <span class="pl-k">+</span> measuredHeight)
        } <span class="pl-k">else</span> {
            autoLayout(<span class="pl-c1">this</span>@CustomViewGroup.measuredWidth <span class="pl-k">-</span> x <span class="pl-k">-</span> measuredWidth, y)
        }
    }
}</pre></div>
<h2>å†™ä¸ªè‡ªå®šä¹‰ ViewGroup è¯•è¯•</h2>
<p><img src="https://blog-image.ian2018.cn/images/3afa2ec5945a1469af18d637e5c965e1a4eb13e3.png"></p>
<p>å°±ä»¥è®¡ç®—å™¨ç•Œé¢ä¸ºä¾‹å§ã€‚ä¸Šé¢ğŸ‘†æ˜¯é€šè¿‡ ConstraintLayout å®ç°çš„ï¼Œçœ‹çœ‹æœ‰å“ªäº›æ§ä»¶ï¼Œ1 ä¸ª EditTextï¼Œ17 ä¸ª Buttonã€‚æˆ‘ä»¬æ¥è¯•è¯•ç”¨è‡ªå®šä¹‰ ViewGroup æ¥ç®€å•å¤åˆ»ä¸€ä¸‹ï¼Œç›´æ¥ä¸Šä»£ç å§ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"><span class="pl-k">class</span> <span class="pl-en">CalculatorLayout</span>(<span class="pl-smi">context</span><span class="pl-k">:</span> <span class="pl-en">Context</span>) : CustomViewGroup(context) {
    <span class="pl-c"><span class="pl-c">//</span> æˆ‘ä»¬å¯ä»¥ç›´æ¥è¿™æ ·åœ¨æŠŠæ§ä»¶ new å‡ºæ¥ï¼Œè®¾ç½®ä¸€äº›å±æ€§ï¼Œè¿™æ ·æˆ‘ä»¬è¿˜çœå»äº† findViewByIdï¼Œè€Œä¸”ä¸ç”¨æ‹…å¿ƒç©ºæŒ‡é’ˆ</span>
    <span class="pl-k">val</span> etResult <span class="pl-k">=</span> <span class="pl-en">AppCompatEditText</span>(context).<span class="pl-c1">apply</span> {
        typeface <span class="pl-k">=</span> <span class="pl-en">ResourcesCompat</span>.getFont(context, <span class="pl-en">R</span>.font.comfortaa_regular)
        setTextColor(<span class="pl-en">ResourcesCompat</span>.getColor(resources, <span class="pl-en">R</span>.color.white, <span class="pl-c1">null</span>))
        background <span class="pl-k">=</span> <span class="pl-c1">null</span>
        textSize <span class="pl-k">=</span> <span class="pl-c1">65f</span>
        gravity <span class="pl-k">=</span> <span class="pl-en">Gravity</span>.<span class="pl-en">BOTTOM</span> <span class="pl-k">or</span> <span class="pl-en">Gravity</span>.<span class="pl-en">END</span>
        maxLines <span class="pl-k">=</span> <span class="pl-c1">1</span>
        isFocusable <span class="pl-k">=</span> <span class="pl-c1">false</span>
        isCursorVisible <span class="pl-k">=</span> <span class="pl-c1">false</span>
        setPadding(<span class="pl-c1">16</span>.dp, paddingTop, <span class="pl-c1">16</span>.dp, paddingBottom)
        layoutParams <span class="pl-k">=</span> <span class="pl-en">LayoutParams</span>(<span class="pl-en">LayoutParams</span>.<span class="pl-en">MATCH_PARENT</span>, <span class="pl-en">LayoutParams</span>.<span class="pl-en">WRAP_CONTENT</span>)
        <span class="pl-c"><span class="pl-c">//</span> æ³¨æ„ï¼Œè¿™é‡Œç›´æ¥ add ä¸ä¼šè§¦å‘ onMeasure è¿™äº›æµç¨‹ï¼Œå¯ä»¥æ”¾å¿ƒ add</span>
        addView(<span class="pl-c1">this</span>)
    }
    <span class="pl-c"><span class="pl-c">//</span> æ•°å­—é”®ç›˜åé¢çš„èƒŒæ™¯</span>
    <span class="pl-k">val</span> keyboardBackgroundView <span class="pl-k">=</span> <span class="pl-en">View</span>(context).<span class="pl-c1">apply</span> {<span class="pl-k">..</span>.}

    <span class="pl-k">class</span> <span class="pl-en">NumButton</span>(<span class="pl-smi">context</span><span class="pl-k">:</span> <span class="pl-en">Context</span>, <span class="pl-smi">text</span><span class="pl-k">:</span> <span class="pl-c1">String</span>, <span class="pl-smi">parent</span><span class="pl-k">:</span> <span class="pl-en">ViewGroup</span>) : AppCompatTextView(context) {
        <span class="pl-en">init</span> {
            setText(text)
            gravity <span class="pl-k">=</span> <span class="pl-en">Gravity</span>.<span class="pl-en">CENTER</span>
            background <span class="pl-k">=</span>
                <span class="pl-en">ResourcesCompat</span>.getDrawable(resources, <span class="pl-en">R</span>.drawable.ripple_cal_btn_num, <span class="pl-c1">null</span>)
            layoutParams <span class="pl-k">=</span>
                <span class="pl-en">MarginLayoutParams</span>(<span class="pl-en">LayoutParams</span>.<span class="pl-en">WRAP_CONTENT</span>, <span class="pl-en">LayoutParams</span>.<span class="pl-en">WRAP_CONTENT</span>).<span class="pl-c1">apply</span> {
                    leftMargin <span class="pl-k">=</span> <span class="pl-c1">2</span>.dp
                    rightMargin <span class="pl-k">=</span> <span class="pl-c1">2</span>.dp
                    topMargin <span class="pl-k">=</span> <span class="pl-c1">6</span>.dp
                    bottomMargin <span class="pl-k">=</span> <span class="pl-c1">6</span>.dp
                }
            isClickable <span class="pl-k">=</span> <span class="pl-c1">true</span>
            setTextAppearance(context, <span class="pl-en">R</span>.style.<span class="pl-en">StyleCalBtn</span>)
            parent.addView(<span class="pl-c1">this</span>)
        }
    }
  
    <span class="pl-k">val</span> btn0 <span class="pl-k">=</span> <span class="pl-en">NumButton</span>(context, <span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span>, <span class="pl-c1">this</span>)
    <span class="pl-k">..</span>.

    <span class="pl-en">init</span> {
        <span class="pl-c"><span class="pl-c">//</span> ç»™è‡ªå·±è®¾ç½®ä¸ªèƒŒæ™¯</span>
        background <span class="pl-k">=</span> <span class="pl-en">ResourcesCompat</span>.getDrawable(resources, <span class="pl-en">R</span>.drawable.shape_cal_bg, <span class="pl-c1">null</span>)
    }

    <span class="pl-k">override</span> <span class="pl-k">fun</span> <span class="pl-en">onMeasure</span>(<span class="pl-smi">widthMeasureSpec</span><span class="pl-k">:</span> <span class="pl-c1">Int</span>, <span class="pl-smi">heightMeasureSpec</span><span class="pl-k">:</span> <span class="pl-c1">Int</span>) {
        <span class="pl-c1">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec)
        <span class="pl-c"><span class="pl-c">//</span> å…ˆç®—ä¸€ä¸‹æ•°å­—æŒ‰é’®çš„å¤§å°</span>
        <span class="pl-k">val</span> allSize <span class="pl-k">=</span>
            measuredWidth <span class="pl-k">-</span> keyboardBackgroundView.paddingLeft <span class="pl-k">-</span> keyboardBackgroundView.paddingRight <span class="pl-k">-</span>
                    btn0.marginLeft <span class="pl-k">*</span> <span class="pl-c1">8</span>
        <span class="pl-k">val</span> numBtSize <span class="pl-k">=</span> (allSize <span class="pl-k">*</span> (<span class="pl-c1">1</span> <span class="pl-k">/</span> <span class="pl-c1">3.8</span>)).toInt()
        <span class="pl-c"><span class="pl-c">//</span> è®¡ç®—æ“ä½œæŒ‰é’®çš„å¤§å°</span>
        <span class="pl-k">val</span> operatorBtWidth <span class="pl-k">=</span> (allSize <span class="pl-k">*</span> (<span class="pl-c1">0.8</span> <span class="pl-k">/</span> <span class="pl-c1">3.8</span>)).toInt()
        <span class="pl-k">val</span> operatorBtHeight <span class="pl-k">=</span> (numBtSize <span class="pl-k">*</span> <span class="pl-c1">4</span> <span class="pl-k">+</span> btn0.marginTop <span class="pl-k">*</span> <span class="pl-c1">6</span> <span class="pl-k">-</span> btnDel.marginTop <span class="pl-k">*</span> <span class="pl-c1">8</span>) <span class="pl-k">/</span> <span class="pl-c1">5</span>

        <span class="pl-c"><span class="pl-c">//</span> å†è®¡ç®—æ•°å­—ç›˜çš„é«˜åº¦</span>
        <span class="pl-k">val</span> keyboardHeight <span class="pl-k">=</span>
            keyboardBackgroundView.paddingTop <span class="pl-k">+</span> keyboardBackgroundView.paddingBottom <span class="pl-k">+</span>
                    numBtSize <span class="pl-k">*</span> <span class="pl-c1">4</span> <span class="pl-k">+</span> btn0.marginTop <span class="pl-k">*</span> <span class="pl-c1">8</span>

        <span class="pl-c"><span class="pl-c">//</span> æœ€åæŠŠé«˜åº¦å‰©ä½™ç©ºé—´éƒ½ç»™ EditText</span>
        <span class="pl-k">val</span> editTextHeight <span class="pl-k">=</span> measuredHeight <span class="pl-k">-</span> keyboardHeight

        <span class="pl-c"><span class="pl-c">//</span> æµ‹é‡èƒŒæ™¯</span>
        keyboardBackgroundView.measure(
            measuredWidth.toExactlyMeasureSpec(),
            keyboardHeight.toExactlyMeasureSpec()
        )

        <span class="pl-c"><span class="pl-c">//</span> æµ‹é‡æŒ‰é’®</span>
        btn0.measure(numBtSize.toExactlyMeasureSpec(), numBtSize.toExactlyMeasureSpec())
        <span class="pl-k">..</span>.
        btnDiv.measure(operatorBtWidth.toExactlyMeasureSpec(), operatorBtHeight.toExactlyMeasureSpec())
        <span class="pl-k">..</span>.

        <span class="pl-c"><span class="pl-c">//</span> æµ‹é‡ EditText</span>
        etResult.measure(
            measuredWidth.toExactlyMeasureSpec(),
            editTextHeight.toExactlyMeasureSpec()
        )

        <span class="pl-c"><span class="pl-c">//</span> æœ€åè®¾ç½®è‡ªå·±çš„å®½é«˜</span>
        setMeasuredDimension(measuredWidth, measuredHeight)
    }

    <span class="pl-k">override</span> <span class="pl-k">fun</span> <span class="pl-en">onLayout</span>(<span class="pl-smi">changed</span><span class="pl-k">:</span> <span class="pl-c1">Boolean</span>, <span class="pl-smi">l</span><span class="pl-k">:</span> <span class="pl-c1">Int</span>, <span class="pl-smi">t</span><span class="pl-k">:</span> <span class="pl-c1">Int</span>, <span class="pl-smi">r</span><span class="pl-k">:</span> <span class="pl-c1">Int</span>, <span class="pl-smi">b</span><span class="pl-k">:</span> <span class="pl-c1">Int</span>) {
        <span class="pl-c"><span class="pl-c">//</span> å¥½äº†ï¼Œæµ‹é‡éƒ½å®Œäº†ï¼Œå°±ä¸€ä¸ªä¸ªæ”¾å§</span>
        <span class="pl-c"><span class="pl-c">//</span> å…ˆæ”¾ EditText</span>
        etResult.autoLayout()

        <span class="pl-c"><span class="pl-c">//</span> æŠŠèƒŒæ™¯æ”¾ä¸Š</span>
        keyboardBackgroundView.autoLayout(<span class="pl-c1">0</span>, etResult.bottom)

        <span class="pl-c"><span class="pl-c">//</span> å¼€å§‹æ”¾æŒ‰é’®å§</span>
        btn7.<span class="pl-c1">let</span> {
            it.autoLayout(
                keyboardBackgroundView.paddingLeft <span class="pl-k">+</span> it.marginLeft,
                keyboardBackgroundView.top <span class="pl-k">+</span> keyboardBackgroundView.paddingTop <span class="pl-k">+</span> it.marginTop
            )
        }
        btn8.<span class="pl-c1">let</span> {
            it.autoLayout(
                btn7.right <span class="pl-k">+</span> btn7.marginRight <span class="pl-k">+</span> it.marginLeft,
                btn7.top
            )
        }
        btn9.<span class="pl-c1">let</span> {
            it.autoLayout(
                btn8.right <span class="pl-k">+</span> btn8.marginRight <span class="pl-k">+</span> it.marginLeft,
                btn7.top
            )
        }
        <span class="pl-k">..</span>.
    }
}</pre></div>
<p>Okï¼Œä»¥ä¸Šå°±å®Œæˆäº†è‡ªå®šä¹‰ ViewGroupï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿™æ ·ç”¨äº†ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"><span class="pl-k">override</span> <span class="pl-k">fun</span> <span class="pl-en">onCreate</span>(<span class="pl-smi">savedInstanceState</span><span class="pl-k">:</span> <span class="pl-en">Bundle</span><span class="pl-k">?</span>) {
    <span class="pl-c1">super</span>.onCreate(savedInstanceState)
    <span class="pl-k">val</span> contentView <span class="pl-k">=</span> <span class="pl-en">CalculatorLayout</span>(<span class="pl-c1">this</span>)
    setContentView(contentView)
    
    <span class="pl-c"><span class="pl-c">//</span> ä¸ç”¨ findViewById å’Œ ktxæ’ä»¶ã€ViewBinding è¿™äº›ä¸œè¥¿ï¼Œç›´æ¥ç”¨å°±å¯ä»¥</span>
    contentView.btnDel.setOnClickListener {
        contentView.etResult.setText(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
    }
}</pre></div>
<p>çœ‹çœ‹æœ€ç»ˆçš„å¯¹æ¯”æ•ˆæœï¼š</p>
<p><img src="https://blog-image.ian2018.cn/images/eac7aa7435f613da784a1ab8ab2af6545a3cd845.png"></p>
<p>çœ‹ä¸Šå»è¿˜ç®—å¯ä»¥ï¼Œæ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯ç”¨ Kotlin ä»£ç å†™å¸ƒå±€ä¹Ÿä¸æ˜¯å¾ˆå¤æ‚ï¼Œç¼ºç‚¹å°±æ˜¯ä¸èƒ½åœ¨ Android Studio ä¸Šé¢„è§ˆï¼ˆå…¶å®æ˜¯å¯ä»¥æ˜¾ç¤ºé¢„è§ˆæ¡†çš„ï¼Œåªè¦åœ¨è‡ªå®šä¹‰ View çš„æ„é€ æ–¹æ³•åŠ ä¸Š AttributeSet å‚æ•°å°±å¯ä»¥äº†ï¼Œä¸è¿‡ä¸ä¸€å®šèƒ½æ˜¾ç¤ºæˆåŠŸï¼Œåæ­£æˆ‘è¿™é¢„è§ˆçš„è¿˜æ˜¯ç°è‰²çš„ï¼‰ã€‚</p>
<h2>ç»“æŸäº†ï¼Ÿ</h2>
<p>è¿™å°±å®Œäº†ï¼Ÿæ˜¯ä¸æ˜¯æ„Ÿè§‰è¿˜å°‘ç‚¹ï¼Œå¦‚æœæˆ‘åœ¨ xml é‡Œè®¾ç½®äº† style æ€ä¹ˆåŠï¼Ÿè®¾ç½® style å¯æ˜¯å‡å°‘é‡å¤ä»£ç çš„å¸¸ç”¨æ‰‹æ®µï¼Œé‚£ä¹ˆæ€ä¹ˆåœ¨ä»£ç é‡Œè®¾ç½® style å‘¢ï¼Ÿ</p>
<p>æ®æˆ‘æ‰€çŸ¥ï¼ŒAndroid å®˜æ–¹æ˜¯æ²¡æœ‰æä¾›è®¾ç½® style çš„ API çš„ï¼Œé‚£ä¹ˆå°±æ²¡æ³•ç”¨ style äº†å—ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸ªæ€è·¯ã€‚</p>
<p>æˆ‘ä»¬ç”¨ style æ˜¯ä¸ºäº†å‡å°‘ç›¸åŒæ ·å¼ View çš„é‡å¤ä»£ç ï¼Œå°†é‡å¤ä»£ç æŠ½æˆ style è¾¾åˆ°å¤ç”¨çš„æ•ˆæœï¼Œå…¶å®æˆ‘ä»¬ä¸Šé¢çš„é‚£ç§å†™æ³•å°±å·²ç»è¾¾åˆ°äº†è¿™ä¸ªç›®çš„ï¼Œå°±æ˜¯ <code class="notranslate">NumButton</code> é‚£ä¸ªç±»ï¼Œæˆ‘ä»¬æŠŠé‡å¤çš„å±æ€§è®¾ç½®éƒ½æ”¾åˆ°äº†è¿™ä¸ªç±»é‡Œï¼Œçœ‹ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å·²ç»æ»¡è¶³è®¾ç½® style çš„éœ€æ±‚äº†ã€‚</p>
<p>ä»€ä¹ˆï¼Ÿä½ å°±è¦ç”¨ styleã€‚å¥½å§ï¼Œé‚£å°±å†æ•™å¤§å®¶ä¸€ä¸ªå°æŠ€å·§æ¥ç”¨ä»£ç è®¾ç½® styleã€‚</p>
<p>å¤§å®¶è®°ä¸è®°å¾— View çš„æ„é€ æ–¹æ³•ä¸­æœ‰ä¸€ä¸ªæ˜¯å››ä¸ªå‚æ•°çš„ï¼š</p>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-c">/**</span>
<span class="pl-c"> * ...</span>
<span class="pl-c"> * @param defStyleAttr An attribute in the current theme that contains a</span>
<span class="pl-c"> *        reference to a style resource that supplies default values for</span>
<span class="pl-c"> *        the view. Can be 0 to not look for defaults. </span>
<span class="pl-c"> *        å½“å‰ä¸»é¢˜ä¸­çš„ä¸€ä¸ªå±æ€§ï¼ŒåŒ…å«å¯¹ä¸ºè§†å›¾æä¾›é»˜è®¤å€¼çš„æ ·å¼èµ„æºçš„å¼•ç”¨ã€‚å¯ä»¥ä¸º 0 ä»¥ä¸æŸ¥æ‰¾é»˜è®¤å€¼</span>
<span class="pl-c"> * @param defStyleRes A resource identifier of a style resource that</span>
<span class="pl-c"> *        supplies default values for the view, used only if</span>
<span class="pl-c"> *        defStyleAttr is 0 or can not be found in the theme. Can be 0</span>
<span class="pl-c"> *        to not look for defaults.</span>
<span class="pl-c"> *        ä¸ºè§†å›¾æä¾›é»˜è®¤å€¼çš„æ ·å¼èµ„æºçš„èµ„æºæ ‡è¯†ç¬¦ï¼Œä»…åœ¨ defStyleAttr ä¸º 0 æˆ–åœ¨ä¸»é¢˜ä¸­æ‰¾ä¸åˆ°æ—¶ä½¿ç”¨ã€‚å¯ä»¥ä¸º 0 ä»¥ä¸æŸ¥æ‰¾é»˜è®¤å€¼ã€‚</span>
<span class="pl-c"> * ...</span>
<span class="pl-c"> */</span>
<span class="pl-k">public</span> <span class="pl-smi">View</span>(<span class="pl-s1">context</span>: <span class="pl-s1">Context</span>, <span class="pl-s1">attrs</span>: <span class="pl-s1">AttributeSet</span>?, <span class="pl-s1">defStyleAttr</span>: <span class="pl-s1">Int</span>, <span class="pl-s1">defStyleRes</span>: <span class="pl-s1">Int</span>)</pre></div>
<p>ç€é‡çœ‹ä¸€ä¸‹åä¸¤ä¸ªå‚æ•°çš„æ„æ€ï¼Œå…¶ä¸­ç¬¬å››ä¸ªå‚æ•° defStyleRes ä¸å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„è®¾ç½® style çš„åœ°æ–¹å˜›ã€‚é‚£ä¹ˆæˆ‘ä»¬æƒ³è¦ç»™ View è®¾ç½® style å¯ä»¥è¿™æ ·å†™ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"><span class="pl-c"><span class="pl-c">//</span> æ³¨æ„ï¼Œè¿™é‡Œçš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼  0 ï¼ŒåŸå› ä¸Šé¢æºç æ³¨é‡Šé‡Œå·²ç»å†™äº†</span>
<span class="pl-k">val</span> btn0 <span class="pl-k">=</span> <span class="pl-en">Button</span>(context, <span class="pl-c1">null</span>, <span class="pl-c1">0</span>, <span class="pl-en">R</span>.style.<span class="pl-en">StyleCalBtn</span>)</pre></div>
<p>è¿™æ ·æˆ‘ä»¬å†™çš„ style å°±èƒ½ç”¨äº†ã€‚ä½†æ˜¯... è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæœ‰çš„ View å°±æ²¡ç»™æä¾›å››ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•å’‹åŠï¼Ÿå°±æ¯”å¦‚ <code class="notranslate">AppCompatButton</code> ï¼Œåƒè¿™ç§æƒ…å†µæˆ‘ä»¬æ€ä¹ˆè®¾ç½® style å‘¢ï¼Ÿè¿™æ—¶å€™å°±éœ€è¦çœ‹ä¸€ä¸‹ View çš„ç¬¬ä¸‰ä¸ªå‚æ•° defStyleAttr çš„å«ä¹‰äº†ã€‚</p>
<p>defStyleAttr çš„è§£é‡Šå½“å‰ä¸»é¢˜ä¸­çš„ä¸€ä¸ªå±æ€§ attrï¼Œè¿™ä¸ªå±æ€§é‡Œæœ‰é»˜è®¤ style çš„å¼•ç”¨ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé»˜è®¤ style çš„å¼•ç”¨æ¢æˆæˆ‘ä»¬è‡ªå·±çš„ä¸å°±è¾¾åˆ°äº†è®¾ç½® style çš„ç›®çš„äº†å˜›ã€‚</p>
<p>å…ˆçœ‹ä¸€ä¸‹ <code class="notranslate">AppCompatButton</code> çš„ attr åå­—å«ä»€ä¹ˆï¼š</p>
<div class="highlight highlight-source-java"><pre class="notranslate"><span class="pl-k">public</span> <span class="pl-s1">AppCompatButton</span>(<span class="pl-c1">@</span><span class="pl-c1">NonNull</span> <span class="pl-smi">Context</span> <span class="pl-s1">context</span>, <span class="pl-c1">@</span><span class="pl-c1">Nullable</span> <span class="pl-smi">AttributeSet</span> <span class="pl-s1">attrs</span>) {
    <span class="pl-smi">this</span>(<span class="pl-s1">context</span>, <span class="pl-s1">attrs</span>, <span class="pl-s1">R</span>.<span class="pl-s1">attr</span>.<span class="pl-s1">buttonStyle</span>);
}</pre></div>
<p>æ ¹æ® <code class="notranslate">AppCompatButton</code> çš„æºç å¯ä»¥çŸ¥é“ï¼Œå®ƒçš„ attr å« buttonStyleï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª themeï¼ŒæŠŠ buttonStyle çš„å€¼ç»™è¦†ç›–æ‰ï¼š</p>
<div class="highlight highlight-text-xml"><pre class="notranslate">&lt;<span class="pl-ent">style</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>Theme.CalBtn<span class="pl-pds">"</span></span> <span class="pl-e">parent</span>=<span class="pl-s"><span class="pl-pds">"</span>Theme.CustomViewGroup<span class="pl-pds">"</span></span>&gt;
    <span class="pl-c"><span class="pl-c">&lt;!--</span> æ³¨æ„è¿™é‡Œå‰é¢åŠ äº† android: <span class="pl-c">--&gt;</span></span>
    &lt;<span class="pl-ent">item</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android:buttonStyle<span class="pl-pds">"</span></span>&gt;@style/StyleCalBtn&lt;/<span class="pl-ent">item</span>&gt;
&lt;/<span class="pl-ent">style</span>&gt;</pre></div>
<p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆç”¨è¿™ä¸ªä¸»é¢˜å‘¢ï¼Ÿç›´æ¥ä¼ åˆ° View çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸Šï¼Ÿè¿™æ ·ä¸è¡Œï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è¦çš„æ˜¯ä¸€ä¸ª attrï¼Œä¸èƒ½ä¼  themeã€‚é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥ä» Context ä¸Šåšæ‰‹è„šï¼Œé€šè¿‡ <code class="notranslate">ContextThemeWrapper</code> ç»™ Context å†åŒ…è£…ä¸€å±‚ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"><span class="pl-k">fun</span> Context.<span class="pl-en">toTheme</span>(@StyleRes <span class="pl-smi">style</span><span class="pl-k">:</span> <span class="pl-c1">Int</span>) <span class="pl-k">=</span> <span class="pl-en">ContextThemeWrapper</span>(<span class="pl-c1">this</span>, style)</pre></div>
<p>è¿™æ · View åœ¨é€šè¿‡ <code class="notranslate">context.obtainStyledAttributes()</code> æ–¹æ³•è·å–å±æ€§å€¼çš„æ—¶å€™ï¼Œå°±å¯ä»¥åŠ è½½æˆ‘ä»¬è®¾ç½®çš„ä¸»é¢˜äº†ã€‚</p>
<p>æ–°çš„å†™æ³•å°±å¯ä»¥è¿™æ ·ï¼š</p>
<div class="highlight highlight-source-kotlin"><pre class="notranslate"><span class="pl-c"><span class="pl-c">//</span> æ³¨æ„ï¼Œè¿™é‡Œä¸èƒ½åªä¼  context ï¼Œå¦‚æœåªä¼  context å®ƒå†…éƒ¨ä¼šèµ° (context, null, 0) è¿™ä¸ªæ„é€ ï¼Œå¯¼è‡´è®¾ç½®çš„ style æ— æ•ˆ</span>
<span class="pl-k">val</span> btn0 <span class="pl-k">=</span> <span class="pl-en">AppCompatButton</span>(context.toTheme(<span class="pl-en">R</span>.style.<span class="pl-en">Theme_CalBtn</span>), <span class="pl-c1">null</span>, android.<span class="pl-en">R</span>.attr.buttonStyle)</pre></div>
<p>è¿™ä¸‹å¯ä»¥ç”¨ä»£ç è®¾ç½® style äº†å§ã€‚</p>
<h2>çœŸçš„ç»“æŸäº†</h2>
<p>è™½ç„¶ä¸ xml çš„ä¹¦å†™ç›¸æ¯”ï¼Œç¡®å®æœ‰äº›éº»çƒ¦ï¼Œä½†ç†Ÿç»ƒä¹‹åï¼Œæˆ‘æ„Ÿè§‰éƒ½å·®ä¸å¤šï¼Œè¿˜èƒ½å¸®åŠ©æˆ‘ä»¬å¯¹è‡ªå®šä¹‰ View è¿™å—æ›´åŠ ç†Ÿæ‚‰ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥åœ¨é¡¹ç›®ä¸å¿™çš„æ—¶å€™å…ˆè¯•è¯•è¿™ç§å†™æ³•ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è¯•è¯• Composeï¼Œå…¶å® Compose æœ€ç»ˆä¹Ÿæ˜¯ä¸€ä¸ª ViewGroup ï¼Œå¯ä»¥çœ‹çœ‹ <code class="notranslate">AndroidComposeView</code> ï¼Œå®ƒæœ€ç»ˆä¹Ÿæ˜¯ä¼šæ·»åŠ åˆ° DecorView ä¸Šã€‚</p>
<p>æœ€åæ„Ÿè°¢çº¯çº¯å†™ä½œçš„ä½œè€… <a href="https://github.com/drakeet">drakeet</a> å¤§ç¥çš„åˆ†äº«ã€‚</p>
<p>Demo åœ°å€ï¼š<a href="https://github.com/IAn2018cs/CustomViewGroup">https://github.com/IAn2018cs/CustomViewGroup</a></p>
</div>
<div style="font-size:small;margin-top:8px;float:right;">â¤ï¸ è½¬è½½æ–‡ç« è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼â¤ï¸</br></br><span>â¤ï¸ æ„Ÿè°¢ <span id="user-content-page_uv"></span> ä½å°ä¼™ä¼´çš„ <span id="user-content-page_pv"></span> æ¬¡è®¿é—®è¯¥æ–‡ç« ã€‚</span></br></br></div>
<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">è¯„è®º</button>
<div class="comments" id="comments"></div>
</div>
    <div id="footer">Copyright Â© <span id="year"></span><a href="https://blog.ian2018.club"> IAn2018cs </a>
<p>
<span id="runday"></span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a>
</p>

<script>
if("08/31/2016"!=""){
    var now=new Date();
    var startSite=new Date("08/31/2016");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("year").innerHTML=now.getFullYear();
    if(""!=""){document.getElementById("runday").innerHTML=" â€¢ "+"ç½‘ç«™è¿è¡Œ"+diffDay+"å¤©"+" â€¢ ";}
    else{document.getElementById("runday").innerHTML="ç½‘ç«™è¿è¡Œ"+diffDay+"å¤©"+" â€¢ ";}
}
</script>
</div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek v2.19 https://github.com/Meekdai/Gmeek \n\n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);

function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","chenshuais/chenshuais.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}
</script>
<script async src='//blog-image.ian2018.cn/webviso.min.js' data-page-pv-id='user-content-page_pv' data-page-uv-id='user-content-page_uv'></script>

</html>
